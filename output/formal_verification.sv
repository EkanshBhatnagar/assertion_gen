////////////////////////////////////////////////////////////////////////////////
// Formal Verification Testbench for rr_arbiter
// Generated by Multi-Stage Assertion Generator - Stage 3
//
// This testbench includes:
// - All module parameters
// - All ports declared as logic
// - DUT instantiation (rr_arbiter as DUT)
// - Refined assertions with correct signal references
// - Internal signals accessed via DUT.signal_name
// - Default clocking and reset handling
//
// Note: Incremental progress saved to: output/refined_assertions_progress.sv
////////////////////////////////////////////////////////////////////////////////

////////////////////////////////////////////////////////////////////////////////
// Testbench for rr_arbiter
// Auto-generated by assertion generation pipeline
// Contains DUT instantiation and formal verification assertions
////////////////////////////////////////////////////////////////////////////////

module rr_arbiter_tb;

    // Parameters
    parameter CLIENTS = 4;
    parameter NUM_REQS = 4;
    parameter WIDTH = 8;

    // Port declarations (as logic)
    logic clk;
    logic rst_n;
    logic [CLIENTS-1:0]req;
    logic [CLIENTS-1:0]gnt;

    // DUT Instantiation
    rr_arbiter #(
        .CLIENTS(CLIENTS)
    ) DUT (
        .clk(clk),
        .rst_n(rst_n),
        .req(req),
        .gnt(gnt)
    );

    // Default clocking and reset handling
    default clocking cb @(posedge clk);
    endclocking

    default disable iff (!rst_n);

    // Formal Verification Assertions
    assert property ($onehot(gnt) |-> 1);

    generate
            for (genvar i = 0; i < NUM_REQS; i++) begin
            as__gnt_implies_req: assert property (@(posedge clk) disable iff (!rst_n) gnt[i] |-> req[i] );
        end
        endgenerate

    as__req_implies_gnt: assert property (@(posedge clk) disable iff (!rst_n) (|req) |-> (|gnt));

    generate
        for (genvar i = 0; i < NUM_REQS; i++) begin
            as__round_robin_fairness: assert property (@(posedge clk) disable iff (!rst_n) $past(gnt[i]) && $past(req[i]) && req[i] |-> !gnt[i] throughout (req[i] && !(&(gnt & req) | gnt[i])) );
        end
        endgenerate

    as__gnt_reset: assert property (@(posedge clk) !rst_n |-> (gnt == '0));

    assert property (@(posedge clk) $past(req) != req |-> gnt);

endmodule

////////////////////////////////////////////////////////////////////////////////
// End of Formal Verification Testbench
////////////////////////////////////////////////////////////////////////////////
