# assertion_gen
Formal SVA generation using frontier and local LLMs.

## Prerequisites
- **OpenRouter API key**: export your key as `OPENROUTER_API_KEY` so stage 1 and stage 2 can reach the cloud models listed in `config.py` (currently `openrouter/anthropic/claude-3-opus`).
- **LM Studio server**: start the LM Studio server and make sure the `openai/gpt-oss-20b` model or `verireason-codellama-7b-rtlcoder-verilog-grpo-reasoning-tb` is available at `http://localhost:1234/v1`. Both stage 3 and stage 4 query this local endpoint, so the server must be running before you invoke the pipeline.

## Folder structure
- `design/`: RTL sources (`ARBITER.sv`, `FIFO.sv`) and their associated specification documents (`specification_*.md`).
- `docs/`: Presentation PDF
- `examples/`: curated project slices (e.g., `ft_fifo`, `ft_mmu`, `ft_ptw`, `ft_tlb`) that illustrate how to structure inputs for the pipeline (Taken from AutoSVA repository).
- `output/`: autogenerated artifacts. This is where prompts, generated assertions (`generated_assertions.sv`), formal testbenches, JasperGold TCL scripts, and logs appear.
- Root scripts:
  - `main.py`: orchestrates the full four-stage pipeline (prompt generation → validation → local LM refinement → JasperGold output).
  - `stage1.py`/`stage2.py`/`stage3.py`/`stage4.py`: single-stage runners for debugging or targeted re-runs.
  - `sv_validator.py`: syntax/semantic validator used by stage 2 and validation helpers.
  - `config.py`: centralized settings, including clock/reset names, model endpoints, and output paths.

## Running the pipeline
Run the pipeline with `uv run` so that all stages execute with the same configuration. Use following command to run experiments with FIFO.sv and ARBITER.SV

```
uv run main.py --all --rtl design/ARBITER.sv --top rr_arbiter --spec design/specification_arbiter.md --clock clk --reset rst_n
uv run main.py --all --rtl design/FIFO.sv --spec design/specification_fifo.md --clock clk --reset rst_n
```

The first command targets the arbiter design (top module `rr_arbiter`), while the second runs against the FIFO design. The `--all` flag ensures every stage executes in sequence, using OpenRouter for the earlier stages and the local LM Studio model for stage 3/4.

## Running JasperGold on Olympus Server
After cloining the repository, run the following commands from the root directory.

```
load-research
source /opt/coe/cadence/JASPERGOLD240/setup.JASPERGOLD240.linux.bash

jg output/jaspergold_fpv.tcl
```